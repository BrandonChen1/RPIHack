<!DOCTYPE html>
<html lang="en">

<style>

</style>
<head>
    <meta charset="UTF-8">
    <title id = "ChatroomID">ChatRoom</title>
</head>
<body>
<div id = "loginPage">
    <p id = "error"></p>
    <form id = "loginForm">
        <p> Enter a Username </p>
        <input size = "35" type = "text" id = "username" autocomplete = "off" required>
        <p> Enter a University ID</p>
        <input size = "35" type = "text" id = "UID" autocomplete = "off" required>
        <p>Are you a teacher or a student?</p>
        <input type="radio" name="ts" value="teacher" required> Teacher<br>
        <input type="radio" name="ts" value="student" required> Student<br>
        <input type = "submit">
    </form>
</div>

    <div id = "TeacherCreate">
        Create a Room
        <form id = "CreateRoom">
            <input size ='25' id = 'CreateID'>
            <input type ="submit">
        </form>
    </div>
    <div id = "RoomID">
        <form id="RoomS">
            <br> Join A Room </br>
            <input id = "RoomSubmit">
            <input type = "submit">
        </form>

    </div>
    <div id = 'chat'>
        <div id = 'chatbox'></div>
        <form id="send-message">
            <input size = "35" id = "message" autocomplete = "off">
            <input type = "submit">
        </form>
        <form id="LeaveRequest">
            <input type = "submit" value ="Leave">
        </form>
    </div>

</body>
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
<script>
    jQuery(function($){
        var socket = io.connect();
        var RoomID = $('#RoomID');
        var RoomS = $('#RoomS');
        var RoomSubmit = $('#RoomSubmit');
        var sendmsg = $('#send-message');
        var msg = $('#message');
        var chat = $('#chat');
        var chatbox = $('#chatbox');
        var CreateRoom = $('#CreateRoom');
        var TeacherCreate = $('#TeacherCreate');
        var CreateID = $('#CreateID');
        var $userSubmit = $('#loginForm');
        var $error = $('#error');
        var $user = $('#username');
        var $UID = $('#UID');
        var $login = $('#loginPage');
        var $classes = $('#Classes');
        var Leave = $('#LeaveRequest');


        chat.hide();
        TeacherCreate.hide();
        RoomID.hide();
        //Creating a room to the server
        Leave.submit(function(e){
            e.preventDefault();
            socket.emit('Leave Room',socket.student);
        });
        $userSubmit.submit(function(e){
            e.preventDefault();
            socket.emit('new user', $user.val(), $UID.val(), function(user, UID){
                if($('input[name=ts]:checked') && user){
                    $login.hide();
                    if($('input[name=ts]:checked').val()  == "student"){
                        socket.student = true;
                        RoomID.show();
                    }
                    else{
                        socket.student = false;
                        TeacherCreate.show();
                    }
                }
                else{
                    $error.html('That username is already taken.');
                }
            });
            $userSubmit.val('');
            $UID.val('');
        });


        CreateRoom.submit(function(e){
            e.preventDefault();
            socket.emit('Create-Room',CreateID.val());
            console.log(CreateID.val());
        });

        //Submitting a room to the server
        RoomS.submit(function(e){
            e.preventDefault();
            socket.emit('Join-Room',RoomSubmit.val());

        });

        sendmsg.submit(function(e){
            e.preventDefault();
            socket.emit('Send-message', msg.val());
        });

        socket.on('Invalid-Room',function(data){
            RoomID.show();
            window.alert("Room does not exist");
        });

        socket.on('Valid-Room',function(data){
            socket.ID = data.toString();
            console.log('Receive valid room');
            RoomID.hide();
            chat.show();
        });

        socket.on('Receive-message',function(data){
            console.log("Received From Server");
            chatbox.append(data+ "<br/>");
            msg.val('');
        });

        socket.on('Create-Good',function(data){
            socket.ID = data.toString();
            TeacherCreate.hide();
            chat.show();
            window.alert("Use this room number to join: " + data.toString());
        });

        socket.on('Create-Bad',function(data){
            TeacherCreate.show();
            chat.hide();
            window.alert('Room is already taken');
            CreateID.val('');


        });

        socket.on('Leave-Room-Good',function(data){
            console.log("Got to leave room");
            if(socket.student){
                TeacherCreate.hide();
                chat.hide();
                RoomID.show();
                RoomSubmit.val('');
            }
            else{
                console.log("Herro");
                RoomID.hide();
                TeacherCreate.show();
                CreateID.val('');
                chat.hide();
                chatbox.html('');
            }
        })










    })
</script>
</html>